{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2>Carrito</h2>
  {% if items %}
    <form method="post" action="{% url 'productos:cart_checkout' %}">
      {% csrf_token %}
      <button class="btn btn-success">Pagar y comprar</button>
    </form>
  {% endif %}
</div>

{% if items %}
<div class="cart-wrapper">
  <section class="cart-table">
    <div class="table-responsive">
      <table class="table align-middle mb-4">
        <thead>
          <tr>
            <th>Producto</th>
            <th>Categoría</th>
            <th class="text-center">Cantidad</th>
            <th>Precio</th>
            <th>Subtotal</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% for item in items %}
          <tr>
            <td>{{ item.prod.nombre }}</td>
            <td class="text-muted">{{ item.prod.categoria.nombre }}</td>
            <td class="text-center">{{ item.qty }}</td>
            <td>${{ item.precio }}</td>
            <td><strong>${{ item.subtotal }}</strong></td>
            <td class="text-end">
              <form method="post" action="{% url 'productos:cart_remove' item.prod.pk %}">
                {% csrf_token %}
                <button class="btn btn-sm btn-outline-danger">Eliminar</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
  <aside class="cart-summary">
    <div class="cart-summary__row">
      <span>Subtotal</span>
      <span>${{ order_summary.subtotal|floatformat:2 }}</span>
    </div>
    <div class="cart-summary__row">
      <span>{{ order_summary.iva_label }}</span>
      <span>${{ order_summary.iva|floatformat:2 }}</span>
    </div>
    <div class="cart-summary__row cart-summary__total">
      <span>Total del pedido</span>
      <span>${{ order_summary.total|floatformat:2 }}</span>
    </div>
    <p class="text-muted small mb-3">{{ item_count }} artículo(s) en tu carrito.</p>
    <form method="post" action="{% url 'productos:cart_checkout' %}">
      {% csrf_token %}
      <button class="btn btn-primary w-100">Finalizar compra</button>
    </form>
  </aside>
</div>
{% else %}
<div class="alert alert-info">Tu carrito está vacío.</div>
{% endif %}
{% endblock %}
