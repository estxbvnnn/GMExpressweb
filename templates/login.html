{% extends "base.html" %}
{% load static %}
{% block content %}
<div class="d-flex justify-content-center align-items-center" style="min-height:70vh;">
  <div class="card shadow-sm" style="max-width:920px; width:100%; border-radius:1rem; overflow:hidden;">
    <div class="row g-0">
      <!-- Visual / branding -->
      <div class="col-md-5 d-none d-md-flex align-items-center justify-content-center" style="background:linear-gradient(180deg,#0b4b6f,#0e6a8a); color:#fff;">
        <div class="text-center p-4" style="width:100%;">
          <img src="{% static 'img/logogm.png' %}" alt="{{ empresa.nombre }}" style="height:86px; margin-bottom:1rem; filter:drop-shadow(0 6px 18px rgba(0,0,0,0.18));">
          <h3 class="mb-2" style="font-weight:700;">GM Express</h3>
          <p class="small mb-0" style="opacity:0.95;">Gestión de catálogo, pedidos y citas</p>
          <p class="mt-3 small" style="opacity:0.9; max-width:220px; margin:0 auto;">Accede para administrar tu perfil, ver productos y agendar citas con facilidad.</p>
        </div>
      </div>

      <!-- Form -->
      <div class="col-md-7">
        <div class="card-body p-4 p-md-5">
          <div class="mb-3 text-center d-md-none">
            <img src="{% static 'img/logogm.png' %}" alt="{{ empresa.nombre }}" style="height:64px; margin-bottom:.5rem;">
            <h4 class="mb-0">Iniciar sesión</h4>
            <p class="text-muted small">Accede a tu cuenta para administrar tu perfil y citas</p>
          </div>

          <h4 class="mb-3 d-none d-md-block">Iniciar sesión</h4>

          {# Mostrar errores generales del form (también aparecen por SweetAlert) #}
          {% if form and form.non_field_errors %}
            <div class="alert alert-danger">
              {{ form.non_field_errors }}
            </div>
          {% elif error %}
            <div class="alert alert-danger">{{ error }}</div>
          {% endif %}

          <form method="post" novalidate>
            {% csrf_token %}

            {% if form %}
              <div class="mb-3">
                <label class="form-label">Correo</label>
                {{ form.username }}
                {{ form.username.errors }}
              </div>

              <div class="mb-3">
                <label class="form-label">Contraseña</label>
                {{ form.password }}
                {{ form.password.errors }}
              </div>
            {% else %}
              <div class="mb-3">
                <label class="form-label">Correo</label>
                <input type="email" name="username" class="form-control" placeholder="tu@ejemplo.com" required autofocus value="{{ request.POST.username }}">
              </div>
              <div class="mb-3">
                <label class="form-label">Contraseña</label>
                <input type="password" name="password" class="form-control" placeholder="Contraseña" required>
              </div>
            {% endif %}

            <div class="d-flex justify-content-between align-items-center mb-3">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="remember" id="remember">
                <label class="form-check-label small" for="remember">Recordarme</label>
              </div>
              <div>
                <a href="{% url 'catalogo:register' %}" class="small">¿No tienes cuenta?</a>
              </div>
            </div>

            <div class="d-grid">
              <button class="btn btn-primary btn-lg" type="submit">Entrar</button>
            </div>
          </form>

          <hr class="my-4">
          <p class="small text-center text-muted mb-0">Acceso seguro — GM Express</p>
        </div>
      </div>
    </div>
  </div>
</div>

{# Si LoginView provee errores globales, los mostramos también con SweetAlert (toast ya integrado en base.html) #}
{% if form and form.non_field_errors %}
<script>
  document.addEventListener('DOMContentLoaded', function(){
    const txt = "{{ form.non_field_errors|striptags|escapejs }}";
    if(txt){
      Swal.fire({ icon: 'error', title: txt, toast: true, position: 'top-end', timer: 5000, showConfirmButton: false, timerProgressBar: true });
    }
  });
</script>
{% endif %}
{% endblock %}
